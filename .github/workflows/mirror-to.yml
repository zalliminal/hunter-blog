name: Mirror main to account-A

on:
  push:
    branches: [ main ]   # triggers only on pushes to main branch

jobs:
  mirror:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # fetch all history for a clean push

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "actions@github.com"

      - name: Push to account-A repo
        env:
          TARGET_REPO: github.com/parhamf6/zalliminal.git   # <-- YOUR DESTINATION REPO
          TOKEN: ${{ secrets.ACCOUNT_A_PAT }}
        run: |
          # Add remote using the token (the token is automatically masked in logs)
          git remote add mirror https://x-access-token:${TOKEN}@${TARGET_REPO}
          # Push current HEAD to the main branch of the target repo
          # Using --force ensures the target branch exactly matches this one
          git push mirror HEAD:refs/heads/main --force
